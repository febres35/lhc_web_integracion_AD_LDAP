{"version":3,"file":"82d024432640e184cab5.js","mappings":"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","sources":["webpack://LiveHelperChat/./src/lib/widgets/msgSnippetWidget.js"],"sourcesContent":["import {settings} from '../settings.js';\nimport {UIConstructorIframe} from '../UIConstructorIframe';\nimport {helperFunctions} from '../helperFunctions';\n\nexport class msgSnippetWidget{\n    constructor(prefix) {\n\n        this.attributes = {};\n        this.hidden = false;\n        this.widgetOpen = false;\n        this.invitationOpen = false;\n        this.nhOpen = false;\n\n        this.msop = null;   // Last operator ID who wrote a message\n        this.msg = null;    // Container of the message\n\n        this.cont = new UIConstructorIframe((prefix || 'lhc')+'_msgsnippet_widget_v2', helperFunctions.getAbstractStyle({\n            zindex: \"2147483639\",\n            width: \"300px\",\n            height: \"200px\",\n            position: \"fixed\",\n            display: \"none\",\n        }), null, \"iframe\");\n\n        this.loadStatus = {main : false, theme: false, status: false};\n    }\n\n    checkLoadStatus() {\n        if (this.loadStatus['theme'] == true && this.loadStatus['main'] == true && this.loadStatus['status'] == true) {\n            this.cont.elmDomDoc.body.style.display = \"\";\n            this.fitContent();\n        }\n    }\n\n    renderBody() {\n\n        this.cont.tmpl = this.msg.replace('{dev_type}',(this.attributes.isMobile === true ? 'lhc-mobile' : 'lhc-desktop')).replace('{msg_body}',this.settings['msg_body']).replace('{operator_profile}',this.settings['operator_profile']);\n\n        this.cont.bodyId = 'msgsnippet';\n\n        if (this.cont.constructUIIframe('', this.attributes.staticJS['dir']) === null){\n            return null;\n        }\n\n        // Content invisible untill media loads\n        this.cont.elmDomDoc.body.style.display = \"none\";\n\n        this.cont.elmDom.className += this.attributes.isMobile === true ? ' lhc-mobile' : ' lhc-desktop';\n\n        this.cont.attachUserEventListener(\"click\",  (e) => {\n            this.attributes.eventEmitter.emitEvent('msgSnippetClicked', [{'event': e, 'sender' : 'closeButton'}]);\n            this.attributes.eventEmitter.emitEvent('showWidget', [{'event': e}]);\n        }, \"start-chat-btn\",'msgsnippetstart');\n\n        var _that = this;\n\n        this.cont.attachUserEventListener(\"click\",  (a) => {\n            this.attributes.eventEmitter.emitEvent('msgsnippetClosed', [{'sender' : 'closeButton'}]);\n            a.stopPropagation();\n            _that.hide(true);\n        }, \"close-need-help-btn\",'msgsnippetclose');\n\n        this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['main'] = true; this.checkLoadStatus()},crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_css']}, true);\n\n        if (this.attributes.isMobile == true) {\n            this.cont.insertCssRemoteFile({crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_mobile_css']});\n        }\n\n        if (this.attributes.theme) {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + this.attributes.theme_v}, true);\n        } else {\n            this.loadStatus['theme'] = true;\n            this.checkLoadStatus();\n        }\n\n        // Show need help only if status widget is loaded\n        this.attributes.sload.subscribe((data) => {if(data){this.loadStatus['status'] = true; this.checkLoadStatus()}});\n\n        this.attributes.eventEmitter.emitEvent('showMsgSnippet', [{'sender' : 'closeButton'}]);\n\n        this.attributes.eventEmitter.addListener('unread_message', (dataUnread) => {\n            if (dataUnread.msop) {\n                if (dataUnread.msop == this.msop && dataUnread.msg_body) {\n                    this.showSnippet(dataUnread, true);\n                } else {\n                    this.msop = dataUnread.msop;\n                    helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                        this.msop = data.msop;\n                        this.msg = data.msg;\n                        this.showSnippet(data, true);\n                    })\n                }\n            }\n        });\n\n        this.attributes.eventEmitter.addListener('hide_msg_snippet', () => {\n            this.hide(true);\n        });\n\n        this.attributes.widgetStatus.subscribe((data) => {\n            data == true ? (this.widgetOpen = true, this.hide(true)) : (this.widgetOpen = false, this.show());\n        });\n\n        this.attributes.eventEmitter.addListener('reloadWidget',() => {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + Date.now()}, true);\n        });\n    }\n\n    init(attributes, settings) {\n        this.attributes = attributes;\n        this.settings = settings;\n\n        if (this.settings['msg']) {\n            this.msg = this.settings['msg'];\n        }\n\n        if (this.settings['msop']) {\n            this.msop = this.settings['msop'];\n        }\n\n        if (!this.msg || (this.settings['msop'] && this.msop !== this.settings['msop'])) {\n            helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                this.msop = data.msop;\n                this.msg = data.msg;\n                this.settings['operator_profile'] = data.operator_profile;\n                this.renderBody();\n            })\n        } else {\n            this.renderBody();\n        }\n\n    }\n\n    hide (persistent) {\n\n        if (typeof persistent !== 'undefined' && persistent === true) {\n            this.hidden = true;\n        }\n\n        this.cont.hide();\n\n        if (this.nhOpen == true) {\n            this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n        }\n\n        this.attributes.msgsnippet_status.next(false);\n        this.nhOpen = false;\n    }\n\n    showSnippet(data, showSnippet) {\n        if (showSnippet == true) {\n            this.hidden = false;\n            this.show();\n        }\n        this.cont.elmDomDoc.getElementById('messages-scroll').innerHTML = data.msg_body;\n\n        if (data.operator_profile) {\n            this.cont.elmDomDoc.getElementById('operator-profile-snippet').innerHTML = data.operator_profile;\n        }\n\n        this.fitContent();\n    }\n\n    fitContent() {\n\n        var documentHeight = this.cont.elmDomDoc.getElementById('messages-scroll').offsetHeight;\n\n        var placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n\n        var leftPosition = false;\n\n        if (this.attributes.position_placement == 'bottom_left' || this.attributes.position_placement == 'full_height_left') {\n            placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_left') {\n            placement = {bottom: \"calc(50% + 35px)\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_right') {\n            placement = {bottom: \"calc(50% + 35px)\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n        }\n\n        this.cont.massRestyle(placement);\n    }\n\n    show () {\n        if (this.hidden == true || this.widgetOpen == true || this.invitationOpen == true || this.attributes.onlineStatus.value == false) {\n            return;\n        }\n\n        if (this.attributes.hideOffline === false) {\n            this.cont.show();\n            if (this.nhOpen == false) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetShow', []);\n                this.attributes.msgsnippet_status.next(true);\n            }\n            this.nhOpen = true;\n        } else {\n            this.cont.hide();\n            if (this.nhOpen == true) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n                this.attributes.msgsnippet_status.next(false);\n            }\n            this.nhOpen = false;\n        }\n    }\n}"],"names":["msgSnippetWidget","prefix","this","attributes","hidden","widgetOpen","invitationOpen","nhOpen","msop","msg","cont","UIConstructorIframe","helperFunctions","zindex","width","height","position","display","loadStatus","main","theme","status","elmDomDoc","body","style","fitContent","tmpl","replace","isMobile","settings","bodyId","constructUIIframe","staticJS","elmDom","className","attachUserEventListener","e","eventEmitter","emitEvent","_that","a","stopPropagation","hide","insertCssRemoteFile","onload","checkLoadStatus","crossOrigin","href","id","LHC_API","args","lhc_base_url","theme_v","sload","subscribe","data","addListener","dataUnread","msg_body","showSnippet","params","getSessionAttributes","widgetStatus","show","Date","now","operator_profile","renderBody","persistent","msgsnippet_status","next","getElementById","innerHTML","documentHeight","offsetHeight","placement","bottom","widgetDimesions","value","wbottom","right","wright","position_placement","left","massRestyle","onlineStatus","hideOffline"],"sourceRoot":""}